<?php defined('YUEAI') or exit('Access Denied!');/** * 插件类 * @author  * */class Plugin{	/**	 * 版本获取工具	 *	 * @author 	 *	 * @param $verpath 版本存放路径	 * @param $gameurl 游戏根目录HTTP地址	 *	 * @return $flashver['num'] 版本号, $flashver['swf'] Flash文件	 */	static function versionPlugin($version_dir)	{		$flashvers = array();		$request = array_merge($_GET, $_POST);		$uselocal = $request['uselocal']==1 ? 1 : 0;				if(!is_dir($version_dir))		{			die('version path error!');		}				$version_dir   = substr($version_dir, -1)=='/'?$version_dir:$version_dir.'/';		$version_path = $version_dir . 'v.php';				$flashver['num'] = file_exists($version_path) ? trim(file_get_contents($version_path)) : '0.1';		$flashver['swf']= require_once $version_dir . ( $uselocal ? "v.local.php" : "v.{$flashver['num']}.php" );				return $flashver;	}		/**	 * 跳转测试工具	 *	 * @author 	 *	 * @return string	 */	static function jumpPlugin($gameurl)	{		$request = array_merge($_GET, $_POST); // 即除去$_COOKIE的$request		$request = Plugin::parseTxRequest($request);				if(!empty($request['url']) && $request['deb'] == 1)		{			$redirect_url   = trim($request['url']);			$redirect_url   = $request['rturl'] = substr($redirect_url, -1)=='/'?$redirect_url:$redirect_url.'/';			$redirect_url   = $redirect_url . 'application/';						unset($request['url']);			$redirect_url.= '?' . http_build_query($request);			echo '<meta http-equiv="refresh" content="0;url=' . $redirect_url . '">'; exit;		}				if(!empty($request['rturl']) && $request['deb'] == 1)		{			return trim($request['rturl']);		}				return $gameurl;	}		/**	 * 腾讯从URL向IFRAME透参数解析	 *	 * @author 	 *	 * @app_custom deb-1|url-http://app23025.t.tqapp.cn/boyaa_test/	 */	static function parseTxRequest($request)	{		if(!empty($request['app_custom']))		{			$ac = urldecode(trim($request['app_custom']));			$qs = str_replace('-', '=', str_replace('|', '&', $ac));			parse_str($qs, &$qs);			$request = array_merge($request, $qs);			unset($request['app_custom']);		}				return $request;	}		/**	 * 获取URL地址信息	 *	 * @author 	 *	 * @return array	 */	static function getUrl()	{	    //版本信息		$flashver = self::versionPlugin(APP_VER_PATH . 'cfg/');		//地址信息		$urlInfo = array();		$urlInfo['gameurl']   = Core_Game::$gameRoot; //根目录地址		$urlInfo['gameurl']   = Plugin::jumpPlugin($urlInfo['gameurl']);		$urlInfo['apiurl']    = $urlInfo['gameurl'] . 'application/'; //FLASH接口地址		$urlInfo['xmlurl']    = $urlInfo['gameurl'] . 'application/' . GAMENAME . '/' . PLATFORM . '/versions/xml/'; //XML,data地址  		$urlInfo['flashurl']  = Core_Game::$cdnRoot . 'flash/' . $flashver['num'] . '/'; //CDN FLASH地址  		$urlInfo['imageurl']  = Core_Game::$cdnRoot . 'images/'; //CDN 图片地址		$urlInfo['scripturl'] = Core_Game::$cdnRoot . 'js/'; //CDN 脚本地址		//FLASH本地调试		if($_REQUEST['uselocal'] == 1)		{			$urlInfo['flashurl'] = Core_Game::$gameRootLocal . 'ut.flash/' . GAMENAME . '/' . PLATFORM . '/core/';			$urlInfo['xmlurl']   = $urlInfo['flashurl'];		}	    		return $urlInfo;	}}